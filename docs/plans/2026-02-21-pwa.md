# PWA Support Implementation Plan

> **For Claude:** REQUIRED SUB-SKILL: Use superpowers:executing-plans to implement this plan task-by-task.

**Goal:** Add iOS "Add to Home Screen" PWA support — manifest, icons, and HTML meta tags.

**Architecture:** Static files only. No service worker, no new runtime deps. `sharp` added as a dev dep for one-time icon generation. All icon paths use the `/run-weather/` base path for GitHub Pages compatibility.

**Tech Stack:** Vite 7, sharp (dev dep for icon generation).

---

### Task 1: Generate app icons

**Files:**

- Create: `scripts/generate-icons.mjs`
- Create: `public/icons/icon-192.png` (generated artifact)
- Create: `public/icons/icon-512.png` (generated artifact)
- Modify: `package.json` (add `generate:icons` script + `sharp` devDep)

**Step 1: Install sharp**

```bash
npm install --save-dev sharp
```

Expected: `sharp` appears in `package.json` devDependencies, `package-lock.json` updated.

**Step 2: Write the icon generator**

Create `scripts/generate-icons.mjs`:

```js
import sharp from 'sharp';
import { mkdirSync } from 'fs';

const svg = Buffer.from(`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100">
  <circle cx="50" cy="50" r="50" fill="#22c55e"/>
  <text x="50" y="68" font-family="system-ui,sans-serif" font-size="52"
        font-weight="700" text-anchor="middle" fill="white">R</text>
</svg>`);

mkdirSync('public/icons', { recursive: true });
await sharp(svg).resize(192, 192).png().toFile('public/icons/icon-192.png');
console.log('✓ icon-192.png');
await sharp(svg).resize(512, 512).png().toFile('public/icons/icon-512.png');
console.log('✓ icon-512.png');
```

**Step 3: Add generate:icons script to package.json**

In `package.json`, add to `"scripts"`:

```json
"generate:icons": "node scripts/generate-icons.mjs"
```

**Step 4: Run the generator**

```bash
npm run generate:icons
```

Expected output:

```
✓ icon-192.png
✓ icon-512.png
```

Verify:

```bash
ls -lh public/icons/
```

Expected: two PNG files, each > 1 KB.

**Step 5: Commit**

```bash
git add scripts/generate-icons.mjs public/icons/ package.json package-lock.json
git commit -m "feat: add icon generator and PWA app icons"
```

---

### Task 2: Add PWA manifest

**Files:**

- Create: `public/manifest.json`

**Step 1: Create the manifest**

Create `public/manifest.json`:

```json
{
  "name": "Run Weather",
  "short_name": "Run Weather",
  "description": "Find the best time to run based on weather forecasts",
  "start_url": "/run-weather/",
  "display": "standalone",
  "background_color": "#f9fafb",
  "theme_color": "#22c55e",
  "icons": [
    {
      "src": "/run-weather/icons/icon-192.png",
      "sizes": "192x192",
      "type": "image/png"
    },
    {
      "src": "/run-weather/icons/icon-512.png",
      "sizes": "512x512",
      "type": "image/png"
    }
  ]
}
```

**Step 2: Validate it is valid JSON**

```bash
node -e "JSON.parse(require('fs').readFileSync('public/manifest.json','utf8')); console.log('valid JSON')"
```

Expected: `valid JSON`

**Step 3: Commit**

```bash
git add public/manifest.json
git commit -m "feat: add PWA web app manifest"
```

---

### Task 3: Wire up index.html

**Files:**

- Modify: `index.html`

**Step 1: Read index.html**

Read `index.html` to see the current `<head>` structure before editing.

**Step 2: Add manifest link and Apple meta tags**

Insert the following five lines inside `<head>`, directly after the `<meta name="viewport" ...>` line:

```html
<link rel="manifest" href="/run-weather/manifest.json" />
<meta name="apple-mobile-web-app-capable" content="yes" />
<meta name="apple-mobile-web-app-status-bar-style" content="default" />
<meta name="apple-mobile-web-app-title" content="Run Weather" />
<link rel="apple-touch-icon" href="/run-weather/icons/icon-192.png" />
```

Note: `apple-touch-icon` is required specifically for iOS — iOS ignores manifest icons for the home screen shortcut.

**Step 3: Verify build succeeds**

```bash
npm run build
```

Expected: completes with no errors.

**Step 4: Verify dev server serves the assets**

```bash
npm run dev
```

Open in browser and confirm these URLs return content:

- `http://localhost:5173/run-weather/manifest.json` → JSON response
- `http://localhost:5173/run-weather/icons/icon-192.png` → green R icon

**Step 5: Commit**

```bash
git add index.html
git commit -m "feat: add PWA manifest link and Apple meta tags"
```

---

### Task 4: Final verification

**Step 1: Run lint**

```bash
npm run lint
```

Expected: no errors. If there are formatting issues, run `npm run format` first, then re-run lint.

**Step 2: Run production build**

```bash
npm run build
```

Expected: no errors.

**Step 3: Commit if lint required formatting fixes**

```bash
git add -A
git commit -m "chore: formatting fixes"
```
